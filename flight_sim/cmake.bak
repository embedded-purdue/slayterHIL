cmake_minimum_required(VERSION 3.16)

project(flight_sim LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

# Eigen
find_package(Eigen3 3.4 REQUIRED NO_MODULE)

# Protobuf (use CONFIG package so we get imported targets and proper transitive deps)
find_package(Protobuf REQUIRED CONFIG)

# Main executable
add_executable(${PROJECT_NAME} src/main.cpp)

# Generate protobuf sources and attach them to the main target
# (works with Protobuf's CONFIG package)
protobuf_generate(
  TARGET ${PROJECT_NAME}
  LANGUAGE cpp
  PROTOS ${CMAKE_CURRENT_SOURCE_DIR}/../shared/proto/sensor_data.proto
)

# Includes
target_include_directories(${PROJECT_NAME}
  PRIVATE
    ${CMAKE_SOURCE_DIR}/lib
)

# Link libs via imported targets (this pulls Abseil in transitively)
target_link_libraries(${PROJECT_NAME}
  PRIVATE
    Eigen3::Eigen
    protobuf::libprotobuf
)

# Other executables (link what they need; add libs if they use protobuf/Eigen)
add_executable(UDPServer src/UDPServer.cpp)
add_executable(UDPClient src/UDPClient.cpp)

